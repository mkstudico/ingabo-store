
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkout - INGABO</title>
    
    <!-- Screen detection and redirect -->
    <script>
        // Check screen size and redirect to mobile version if needed
        function checkScreenSizeAndRedirect() {
            // Redirect to mobile version if screen width is less than 768px
            if (window.innerWidth < 768) {
                window.location.href = 'cartp.html';
                return true;
            }
            return false;
        }
        
        // Check on page load
        window.addEventListener('DOMContentLoaded', function() {
            if (checkScreenSizeAndRedirect()) {
                return;
            }
        });
        
        // Also check on resize
        window.addEventListener('resize', function() {
            if (checkScreenSizeAndRedirect()) {
                return;
            }
        });
    </script>
    
    <!-- Styles and scripts -->
    <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- COLOR SYSTEM CYCLE STYLES -->
    <style>
        :root {
            --accent-color: #ff6a00; /* Default color */
        }
    </style>
    
    <style>
        /* ========== RESET & BASE ========== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }
        
        body {
            background-color: #f9f9f9;
            color: #333;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        /* ========== HEADER ========== */
        .checkout-header {
            background: white;
            padding: 20px 0;
            border-bottom: 1px solid #eee;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 20px;
        }
        
        .back-button {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 20px;
            background: var(--accent-color, #ff6a00);
            color: white;
            border: none;
            border-radius: 25px;
            font-weight: 500;
            cursor: pointer;
            text-decoration: none;
            font-size: 14px;
            transition: background 0.3s;
        }
        
        .back-button:hover {
            background: #e55a00;
        }
        
        .logo-area {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo-img {
            width: 45px;
            height: 45px;
        }
        
        .logo-text h1 {
            font-size: 22px;
            font-weight: bold;
            text-transform: uppercase;
            color: #000;
        }
        
        .logo-text span {
            font-size: 12px;
            color: #666;
            display: block;
        }
        
        /* ========== MAIN LAYOUT ========== */
        .checkout-main-layout {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
            margin: 30px 0;
        }
        
        /* ========== CART ITEMS SECTION ========== */
        .cart-items-section {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .section-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 25px;
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .empty-cart {
            text-align: center;
            padding: 60px 20px;
            color: #888;
        }
        
        .empty-cart i {
            font-size: 60px;
            margin-bottom: 20px;
            color: #ddd;
        }
        
        .empty-cart h3 {
            font-size: 20px;
            margin-bottom: 15px;
            color: #666;
        }
        
        .empty-cart p {
            margin-bottom: 25px;
            color: #999;
        }
        
        .shop-now-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 12px 24px;
            background: var(--accent-color, #ff6a00);
            color: white;
            text-decoration: none;
            border-radius: 8px;
            font-weight: 600;
            transition: background 0.3s;
        }
        
        .shop-now-btn:hover {
            background: #e55a00;
        }
        
        /* ========== CART ITEMS LIST ========== */
        .cart-items-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .cart-item {
            display: flex;
            align-items: center;
            padding: 20px;
            border: 1px solid #eee;
            border-radius: 10px;
            transition: box-shadow 0.3s;
            position: relative;
        }
        
        .cart-item:hover {
            box-shadow: 0 2px 15px rgba(0,0,0,0.08);
        }
        
        .item-image {
            width: 100px;
            height: 100px;
            border-radius: 8px;
            overflow: hidden;
            margin-right: 20px;
            flex-shrink: 0;
        }
        
        .item-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .item-info {
            flex: 1;
        }
        
        .item-name {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
        }
        
        .item-details {
            display: flex;
            gap: 15px;
            margin-bottom: 8px;
            font-size: 14px;
            color: #666;
        }
        
        .item-price {
            font-size: 18px;
            font-weight: 700;
            color: var(--accent-color, #ff6a00);
        }
        
        .item-total {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin-left: auto;
            margin-right: 20px;
        }
        
        .quantity-controls {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }
        
        .quantity-btn {
            width: 30px;
            height: 30px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .quantity-btn:hover {
            background: #f0f0f0;
        }
        
        .quantity-input {
            width: 50px;
            text-align: center;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 5px;
            font-size: 14px;
            font-weight: 500;
        }
        
        .remove-item {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            color: #ff4444;
            cursor: pointer;
            padding: 5px;
            font-size: 20px;
            transition: color 0.3s;
        }
        
        .remove-item:hover {
            color: #ff0000;
        }
        
        /* ========== ORDER SUMMARY ========== */
        .order-summary {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            height: fit-content;
            position: sticky;
            top: 100px;
        }
        
        .summary-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 20px;
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .summary-details {
            margin-bottom: 25px;
        }
        
        .summary-row {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .summary-row:last-child {
            border-bottom: none;
        }
        
        .summary-label {
            color: #666;
            font-size: 14px;
        }
        
        .summary-value {
            color: #333;
            font-weight: 500;
            font-size: 14px;
        }
        
        .summary-total {
            display: flex;
            justify-content: space-between;
            padding: 15px 0;
            border-top: 2px solid #eee;
            margin-top: 15px;
            font-size: 18px;
            font-weight: 700;
        }
        
        .total-label {
            color: #333;
        }
        
        .total-amount {
            color: var(--accent-color, #ff6a00);
        }
        
        /* ========== CHECKOUT BUTTON ========== */
        .checkout-btn {
            width: 100%;
            padding: 18px;
            background: #25D366;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            transition: all 0.3s;
            margin-top: 20px;
        }
        
        .checkout-btn:hover {
            background: #128C7E;
            transform: translateY(-2px);
        }
        
        .checkout-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        /* ========== DELIVERY INFO ========== */
        .delivery-info {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            margin-top: 30px;
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-top: 20px;
        }
        
        .info-item {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }
        
        .info-icon {
            font-size: 24px;
            color: var(--accent-color, #ff6a00);
            margin-bottom: 10px;
        }
        
        .info-text {
            font-size: 14px;
            color: #666;
            line-height: 1.5;
        }
        
        /* ========== MODAL ========== */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            padding: 20px;
        }
        
        .modal-overlay.active {
            display: flex;
        }
        
        .confirmation-modal {
            background: white;
            border-radius: 16px;
            padding: 30px;
            width: 100%;
            max-width: 500px;
            text-align: center;
            animation: modalFadeIn 0.3s ease;
        }
        
        @keyframes modalFadeIn {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .modal-icon {
            font-size: 60px;
            color: #25D366;
            margin-bottom: 25px;
        }
        
        .modal-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 20px;
            color: #333;
            line-height: 1.3;
        }
        
        .modal-text {
            color: #666;
            margin-bottom: 30px;
            line-height: 1.6;
            font-size: 16px;
        }
        
        .modal-actions {
            display: flex;
            gap: 15px;
        }
        
        .modal-btn {
            flex: 1;
            padding: 16px;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 16px;
        }
        
        .modal-btn.cancel {
            background: #f8f8f8;
            color: #666;
        }
        
        .modal-btn.cancel:hover {
            background: #e8e8e8;
        }
        
        .modal-btn.confirm {
            background: #25D366;
            color: white;
        }
        
        .modal-btn.confirm:hover {
            background: #128C7E;
        }
        
        /* ========== NOTIFICATION ========== */
        .notification {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: #28a745;
            color: white;
            padding: 20px 25px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 1000;
            animation: slideIn 0.3s ease;
            max-width: 400px;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(100%);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* ========== RESPONSIVE ========== */
        @media (max-width: 1024px) {
            .checkout-main-layout {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .order-summary {
                position: static;
            }
            
            .info-grid {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 0 15px;
            }
            
            .cart-items-section,
            .order-summary,
            .delivery-info {
                padding: 20px;
            }
            
            .cart-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .item-image {
                width: 100%;
                height: 200px;
            }
            
            .item-total {
                margin-left: 0;
                margin-right: 0;
            }
            
            .quantity-controls {
                width: 100%;
                justify-content: space-between;
            }
        }
    </style>
</head>
<body>
    <!-- Confirmation Modal -->
    <div class="modal-overlay" id="confirmationModal">
        <div class="confirmation-modal">
            <div class="modal-icon">
                <i class='bx bxl-whatsapp'></i>
            </div>
            <div class="modal-title">Complete Purchase via WhatsApp</div>
            <div class="modal-text">
                This will open WhatsApp to send your complete order details to the seller. 
                
                <div style="margin-top: 15px; padding: 15px; background: #f8f8f8; border-radius: 8px;">
                    <strong>Delivery Costs:</strong>
                    <div>Kigali: 2,000 RWF</div>
                    <div>Other Cities: 5,000 RWF</div>
                    <div style="margin-top: 10px; font-size: 14px; color: #666;">Delivery is next day. Same-day delivery can be arranged.</div>
                </div>
            </div>
            <div class="modal-actions">
                <button class="modal-btn cancel" id="cancelPurchase">Cancel</button>
                <button class="modal-btn confirm" id="confirmPurchase">Complete Order</button>
            </div>
        </div>
    </div>
    
    <!-- Header -->
    <header class="checkout-header">
        <div class="container">
            <div class="header-content">
                <button onclick="window.history.back()" class="back-button">
                    <i class='bx bx-arrow-back'></i> Back
                </button>
                
                <div class="logo-area">
                    <img src="https://i.ibb.co/1fjd5Ncn/logo.png" alt="INGABO Logo" class="logo-img">
                    <div class="logo-text">
                        <h1>INGABO</h1>
                        <span>Online shop</span>
                    </div>
                </div>
                
                <!-- Empty space for alignment -->
                <div style="width: 120px;"></div>
            </div>
        </div>
    </header>
    
    <!-- Main Content -->
    <div class="container">
        <div id="checkoutContent">
            <div class="checkout-main-layout">
                <!-- Cart Items -->
                <div class="cart-items-section">
                    <h2 class="section-title">
                        <i class='bx bx-cart'></i> Your Cart
                    </h2>
                    
                    <div id="cartItemsContainer">
                        <!-- Cart items will be loaded here -->
                    </div>
                </div>
                
                <!-- Order Summary -->
                <div class="order-summary">
                    <h2 class="summary-title">
                        <i class='bx bx-receipt'></i> Order Summary
                    </h2>
                    
                    <div class="summary-details">
                        <div class="summary-row">
                            <span class="summary-label">Subtotal</span>
                            <span class="summary-value" id="subtotalAmount">0 RWF</span>
                        </div>
                        <div class="summary-row">
                            <span class="summary-label">Delivery Fee</span>
                            <span class="summary-value" id="deliveryFee">0 RWF</span>
                        </div>
                        <div class="summary-row">
                            <span class="summary-label">Tax (0%)</span>
                            <span class="summary-value">0 RWF</span>
                        </div>
                    </div>
                    
                    <div class="summary-total">
                        <span class="total-label">Total</span>
                        <span class="total-amount" id="totalAmount">0 RWF</span>
                    </div>
                    
                    <button class="checkout-btn" id="checkoutBtn">
                        <i class='bx bxl-whatsapp'></i> COMPLETE PURCHASE
                    </button>
                </div>
            </div>
            
            <!-- Delivery Information -->
            <div class="delivery-info">
                <h2 class="section-title">
                    <i class='bx bx-package'></i> Delivery Information
                </h2>
                
                <div class="info-grid">
                    <div class="info-item">
                        <div class="info-icon">
                            <i class='bx bx-time'></i>
                        </div>
                        <div class="info-text">
                            <strong>Delivery Time</strong><br>
                            Next day delivery (Same-day available upon request)
                        </div>
                    </div>
                    
                    <div class="info-item">
                        <div class="info-icon">
                            <i class='bx bx-map'></i>
                        </div>
                        <div class="info-text">
                            <strong>Delivery Areas</strong><br>
                            Kigali: 2,000 RWF<br>
                            Other Cities: 5,000 RWF
                        </div>
                    </div>
                    
                    <div class="info-item">
                        <div class="info-icon">
                            <i class='bx bx-credit-card'></i>
                        </div>
                        <div class="info-text">
                            <strong>Payment Methods</strong><br>
                            Cash on Delivery<br>
                            Mobile Money
                        </div>
                    </div>
                    
                    <div class="info-item">
                        <div class="info-icon">
                            <i class='bx bx-support'></i>
                        </div>
                        <div class="info-text">
                            <strong>Need Help?</strong><br>
                            Contact: +250 792 642 955<br>
                            WhatsApp available 24/7
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Notification -->
    <div id="notificationContainer"></div>

    <script>
        // ==================== COLOR SYSTEM CYCLE ====================
        let accentColors = ['#ff6a00', '#8a2be2', '#2ecc71', '#3498db'];
        let currentHour = new Date().getHours();
        
        function initializeAccentColor() {
            const hour = new Date().getHours();
            const colorIndex = hour % accentColors.length;
            document.documentElement.style.setProperty('--accent-color', accentColors[colorIndex]);
            
            setInterval(() => {
                const currentTime = new Date().getHours();
                if (currentTime !== currentHour) {
                    currentHour = currentTime;
                    const newColorIndex = currentHour % accentColors.length;
                    document.documentElement.style.setProperty('--accent-color', accentColors[newColorIndex]);
                }
            }, 600000);
        }
        
        // ==================== GLOBAL VARIABLES ====================
        let cartItems = [];
        let deliveryFee = 2000; // Default Kigali delivery
        
        // ==================== NOTIFICATION SYSTEM ====================
        function showNotification(message, type = 'success') {
            const container = document.getElementById('notificationContainer');
            if (!container) return;
            
            container.innerHTML = '';
            
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.style.background = type === 'success' ? '#28a745' : 
                                          type === 'error' ? '#dc3545' : '#ff6a00';
            
            notification.innerHTML = `
                <i class='bx ${type === 'success' ? 'bx-check-circle' : 'bx-error-circle'}'></i>
                <span>${message}</span>
            `;
            
            container.appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 5000);
        }
        
        // ==================== HELPER FUNCTIONS ====================
        function formatPrice(price) {
            return price.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }
        
        // ==================== CART MANAGEMENT ====================
        function loadCart() {
            cartItems = JSON.parse(localStorage.getItem('ingabo_cart')) || [];
            renderCartItems();
            updateOrderSummary();
        }
        
        function renderCartItems() {
            const container = document.getElementById('cartItemsContainer');
            
            if (cartItems.length === 0) {
                container.innerHTML = `
                    <div class="empty-cart">
                        <i class='bx bx-cart'></i>
                        <h3>Your cart is empty</h3>
                        <p>Add some products to your cart to proceed with checkout</p>
                        <a href="index.html" class="shop-now-btn">
                            <i class='bx bx-shopping-bag'></i> Shop Now
                        </a>
                    </div>
                `;
                
                // Disable checkout button
                const checkoutBtn = document.getElementById('checkoutBtn');
                if (checkoutBtn) {
                    checkoutBtn.disabled = true;
                }
                
                return;
            }
            
            let html = '<div class="cart-items-list">';
            
            cartItems.forEach((item, index) => {
                const itemTotal = item.price * (item.quantity || 1);
                
                html += `
                    <div class="cart-item" data-index="${index}">
                        <button class="remove-item" onclick="removeItem(${index})">
                            <i class='bx bx-trash'></i>
                        </button>
                        
                        <div class="item-image">
                            ${item.image ? 
                                `<img src="${item.image}" alt="${item.name}" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjEwMCIgaGVpZ2h0PSIxMDAiIGZpbGw9IiNGMEYwRjAiLz48cGF0aCBkPSJNNjUgNDBINDVWNjBINjVWNDBaIiBmaWxsPSIjQ0NDQ0NDIi8+PHBhdGggZD0iTTcwIDY1SDMwQzI2IDEwMCAyNiA5NSAzMCA5NUg3MEM3NCA5NSA3NCAxMDAgNzAgNjVaIiBmaWxsPSIjRkZGNkY2Ii8+PC9zdmc+';">` : 
                                `<div style="width:100%;height:100%;background:#f0f0f0;display:flex;align-items:center;justify-content:center;">
                                    <i class='bx bx-image' style="font-size:40px;color:#ccc;"></i>
                                </div>`
                            }
                        </div>
                        
                        <div class="item-info">
                            <div class="item-name">${item.name}</div>
                            <div class="item-details">
                                ${item.color ? `<span>Color: ${item.color}</span>` : ''}
                                ${item.size ? `<span>Size: ${item.size}</span>` : ''}
                            </div>
                            <div class="item-price">${formatPrice(item.price)} RWF</div>
                            
                            <div class="quantity-controls">
                                <button class="quantity-btn" onclick="decreaseQuantity(${index})">-</button>
                                <input type="number" class="quantity-input" value="${item.quantity || 1}" min="1" max="10" 
                                       onchange="updateQuantity(${index}, this.value)" onclick="event.stopPropagation()">
                                <button class="quantity-btn" onclick="increaseQuantity(${index})">+</button>
                            </div>
                        </div>
                        
                        <div class="item-total">${formatPrice(itemTotal)} RWF</div>
                    </div>
                `;
            });
            
            html += '</div>';
            container.innerHTML = html;
        }
        
        function removeItem(index) {
            if (confirm('Are you sure you want to remove this item from your cart?')) {
                cartItems.splice(index, 1);
                localStorage.setItem('ingabo_cart', JSON.stringify(cartItems));
                renderCartItems();
                updateOrderSummary();
                showNotification('Item removed from cart');
            }
        }
        
        function updateQuantity(index, newQuantity) {
            newQuantity = parseInt(newQuantity);
            
            if (isNaN(newQuantity) || newQuantity < 1) newQuantity = 1;
            if (newQuantity > 10) newQuantity = 10;
            
            cartItems[index].quantity = newQuantity;
            localStorage.setItem('ingabo_cart', JSON.stringify(cartItems));
            renderCartItems();
            updateOrderSummary();
        }
        
        function increaseQuantity(index) {
            const currentQty = cartItems[index].quantity || 1;
            if (currentQty < 10) {
                updateQuantity(index, currentQty + 1);
            }
        }
        
        function decreaseQuantity(index) {
            const currentQty = cartItems[index].quantity || 1;
            if (currentQty > 1) {
                updateQuantity(index, currentQty - 1);
            }
        }
        
        function updateOrderSummary() {
            let subtotal = 0;
            
            cartItems.forEach(item => {
                subtotal += item.price * (item.quantity || 1);
            });
            
            const total = subtotal + deliveryFee;
            
            document.getElementById('subtotalAmount').textContent = `${formatPrice(subtotal)} RWF`;
            document.getElementById('deliveryFee').textContent = `${formatPrice(deliveryFee)} RWF`;
            document.getElementById('totalAmount').textContent = `${formatPrice(total)} RWF`;
            
            // Enable/disable checkout button
            const checkoutBtn = document.getElementById('checkoutBtn');
            if (checkoutBtn) {
                checkoutBtn.disabled = cartItems.length === 0;
            }
        }
        
        // ==================== CHECKOUT FUNCTIONALITY ====================
        function setupCheckout() {
            const checkoutBtn = document.getElementById('checkoutBtn');
            const cancelBtn = document.getElementById('cancelPurchase');
            const confirmBtn = document.getElementById('confirmPurchase');
            const modal = document.getElementById('confirmationModal');
            
            if (checkoutBtn) {
                checkoutBtn.addEventListener('click', () => {
                    if (cartItems.length === 0) {
                        showNotification('Your cart is empty', 'error');
                        return;
                    }
                    
                    if (modal) {
                        modal.classList.add('active');
                    }
                });
            }
            
            if (cancelBtn) {
                cancelBtn.addEventListener('click', () => {
                    if (modal) {
                        modal.classList.remove('active');
                    }
                });
            }
            
            if (confirmBtn) {
                confirmBtn.addEventListener('click', completePurchase);
            }
        }
        
        function completePurchase() {
            const modal = document.getElementById('confirmationModal');
            if (modal) {
                modal.classList.remove('active');
            }
            
            if (cartItems.length === 0) {
                showNotification('Your cart is empty', 'error');
                return;
            }
            
            // Calculate totals
            let subtotal = 0;
            let itemsText = '';
            
            cartItems.forEach((item, index) => {
                const itemTotal = item.price * (item.quantity || 1);
                subtotal += itemTotal;
                
                itemsText += `${index + 1}. ${item.name}\n`;
                itemsText += `   Quantity: ${item.quantity || 1}\n`;
                itemsText += `   Price: ${formatPrice(item.price)} RWF\n`;
                itemsText += `   Total: ${formatPrice(itemTotal)} RWF\n`;
                if (item.color) itemsText += `   Color: ${item.color}\n`;
                if (item.size) itemsText += `   Size: ${item.size}\n`;
                itemsText += '\n';
            });
            
            const total = subtotal + deliveryFee;
            
            // Create WhatsApp message
            const message = `ORDER DETAILS - INGABO STORE\n\n` +
                           `Order Summary:\n` +
                           `${itemsText}\n` +
                           `Subtotal: ${formatPrice(subtotal)} RWF\n` +
                           `Delivery Fee: ${formatPrice(deliveryFee)} RWF\n` +
                           `Total Amount: ${formatPrice(total)} RWF\n\n` +
                           `Delivery Information:\n` +
                           `• Kigali: 2,000 RWF\n` +
                           `• Other Cities: 5,000 RWF\n` +
                           `• Next day delivery (Same-day available upon request)\n\n` +
                           `Payment Methods:\n` +
                           `• Cash on Delivery\n` +
                           `• Mobile Money\n\n` +
                           `I would like to purchase these items from INGABO Online Shop.`;
            
            // WhatsApp phone number
            const phoneNumber = '250792642955';
            
            // Encode message for URL
            const encodedMessage = encodeURIComponent(message);
            
            // Create WhatsApp URL
            const whatsappURL = `https://wa.me/${phoneNumber}?text=${encodedMessage}`;
            
            // Open WhatsApp
            window.open(whatsappURL, '_blank');
            
            // Show confirmation
            showNotification('Opening WhatsApp to complete your order...', 'success');
            
            // Optionally clear cart after purchase (uncomment if desired)
            // localStorage.removeItem('ingabo_cart');
            // setTimeout(() => {
            //     window.location.href = 'index.html';
            // }, 2000);
        }
        
        // ==================== INITIALIZATION ====================
        document.addEventListener('DOMContentLoaded', function() {
            initializeAccentColor();
            loadCart();
            setupCheckout();
            
            // Check if coming from empty cart
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('empty') === 'true') {
                showNotification('Your cart is empty. Please add items to proceed.', 'error');
            }
        });
    </script>
</body>
</html>
