<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>INGABO Online Shop</title>
    <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Comfortaa:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Firebase SDK - COMPAT VERSION -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-analytics-compat.js"></script>
    <style>
        /* Reset and base styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background-color: #f9f9f9;
            color: #333;
            font-family: 'Poppins', sans-serif;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px;
        }
        
        /* Announcement Banner */
        .announcement-banner {
            background-color: #ff6a00;
            color: white;
            padding: 10px 20px;
            text-align: center;
            font-size: 14px;
            font-weight: 500;
            display: none;
            animation: slideDown 0.5s ease;
        }
        
        .announcement-banner.show {
            display: block;
        }
        
        .announcement-content {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .announcement-banner a {
            color: white;
            text-decoration: underline;
            font-weight: 600;
            cursor: pointer;
        }
        
        @keyframes slideDown {
            from {
                transform: translateY(-100%);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        /* Paused Mode Overlay */
        .paused-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 99999;
            display: none;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 24px;
            font-weight: bold;
            font-family: 'Comfortaa', cursive;
            text-align: center;
            padding: 20px;
        }
        
        .paused-overlay.active {
            display: flex;
        }
        
        /* Cart Sidebar */
        .cart-sidebar {
            position: fixed;
            top: 0;
            right: -400px;
            width: 380px;
            height: 100%;
            background: white;
            z-index: 10000;
            box-shadow: -5px 0 15px rgba(0,0,0,0.1);
            transition: right 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            flex-direction: column;
        }
        
        .cart-sidebar.active {
            right: 0;
        }
        
        .cart-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 9999;
            display: none;
        }
        
        .cart-overlay.active {
            display: block;
        }
        
        .cart-header {
            padding: 20px;
            background: linear-gradient(135deg, var(--accent-color, #ff6a00), #ff8c42);
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .cart-title {
            font-size: 20px;
            font-weight: bold;
            font-family: 'Comfortaa', cursive;
        }
        
        .close-cart {
            background: none;
            border: none;
            color: white;
            font-size: 28px;
            cursor: pointer;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background 0.3s;
        }
        
        .close-cart:hover {
            background: rgba(255,255,255,0.2);
        }
        
        .cart-items-container {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
        }
        
        .cart-item {
            display: flex;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: background 0.2s;
            border-radius: 8px;
            margin-bottom: 8px;
        }
        
        .cart-item:hover {
            background: #f9f9f9;
        }
        
        .cart-item-image {
            width: 70px;
            height: 70px;
            object-fit: cover;
            border-radius: 8px;
            margin-right: 15px;
            background: #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .cart-item-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 8px;
        }
        
        .cart-item-info {
            flex: 1;
        }
        
        .cart-item-name {
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 5px;
            line-height: 1.3;
        }
        
        .cart-item-price {
            font-size: 15px;
            color: var(--accent-color, #ff6a00);
            font-weight: bold;
        }
        
        .cart-item-quantity {
            font-size: 13px;
            color: #666;
            margin-top: 3px;
        }
        
        .empty-cart {
            text-align: center;
            padding: 60px 20px;
            color: #888;
        }
        
        .empty-cart i {
            font-size: 60px;
            margin-bottom: 15px;
            color: #ddd;
        }
        
        /* Top Header */
        .top-header {
            background-color: #fff;
            border-bottom: 1px solid #e5e5e5;
            padding: 10px 0;
            position: sticky;
            top: 0;
            z-index: 1000;
            backdrop-filter: blur(10px);
            background: rgba(255,255,255,0.95);
        }
        
        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .logo-area {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
        }
        
        .logo-img {
            width: 40px;
            height: 40px;
            transition: transform 0.3s;
        }
        
        .logo-img:hover {
            transform: rotate(-5deg);
        }
        
        .logo-text {
            display: flex;
            flex-direction: column;
        }
        
        .logo-text h1 {
            font-size: 20px;
            font-weight: bold;
            text-transform: uppercase;
            color: #000;
            font-family: 'Comfortaa', cursive;
            letter-spacing: 1px;
        }
        
        .logo-text span {
            font-size: 12px;
            color: #666;
        }
        
        .search-area {
            flex: 1;
            max-width: 500px;
            margin: 0 30px;
            position: relative;
        }
        
        .search-bar {
            width: 100%;
            padding: 12px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 30px;
            font-size: 14px;
            transition: all 0.3s;
            background: #f8f8f8;
        }
        
        .search-bar:focus {
            outline: none;
            border-color: var(--accent-color, #ff6a00);
            background: white;
            box-shadow: 0 0 0 3px rgba(255, 106, 0, 0.1);
        }
        
        .search-button {
            position: absolute;
            right: 5px;
            top: 5px;
            height: calc(100% - 10px);
            background: linear-gradient(135deg, var(--accent-color, #ff6a00), #ff8c42);
            color: white;
            border: none;
            border-radius: 25px;
            padding: 0 25px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }
        
        .search-button:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(255, 106, 0, 0.3);
        }
        
        /* Search Results Dropdown */
        .search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #ddd;
            border-radius: 12px;
            margin-top: 10px;
            max-height: 500px;
            overflow-y: auto;
            display: none;
            z-index: 1000;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            animation: slideDown 0.3s ease;
        }
        
        .search-results.active {
            display: block;
        }
        
        .search-result-item {
            display: flex;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #f0f0f0;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .search-result-item:hover {
            background: #f8f8f8;
        }
        
        .search-result-img {
            width: 50px;
            height: 50px;
            object-fit: cover;
            border-radius: 8px;
            margin-right: 15px;
            background: #f0f0f0;
        }
        
        .search-result-info {
            flex: 1;
        }
        
        .search-result-name {
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 5px;
            color: #333;
        }
        
        .search-result-price {
            font-size: 14px;
            color: var(--accent-color, #ff6a00);
            font-weight: 600;
        }
        
        .search-result-category {
            font-size: 12px;
            color: #888;
            background: #f0f0f0;
            padding: 3px 8px;
            border-radius: 12px;
            margin-left: 8px;
        }
        
        .no-results {
            padding: 30px 20px;
            text-align: center;
            color: #888;
            font-size: 14px;
        }
        
        .also-like-section {
            padding: 20px;
            border-top: 1px solid #eee;
        }
        
        .also-like-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #333;
        }
        
        .also-like-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }
        
        .also-like-item {
            padding: 10px;
            border: 1px solid #eee;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .also-like-item:hover {
            border-color: var(--accent-color, #ff6a00);
            transform: translateY(-2px);
        }
        
        .header-right {
            display: flex;
            align-items: center;
            gap: 25px;
        }
        
        .cart-button {
            display: flex;
            align-items: center;
            gap: 8px;
            background: white;
            color: #333;
            border: 2px solid #e0e0e0;
            border-radius: 30px;
            padding: 10px 20px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }
        
        .cart-button:hover {
            border-color: var(--accent-color, #ff6a00);
            color: var(--accent-color, #ff6a00);
            transform: translateY(-2px);
        }
        
        .cart-count {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #ff0000;
            color: white;
            font-size: 12px;
            font-weight: bold;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .auth-links {
            display: flex;
            gap: 15px;
            font-size: 14px;
        }
        
        .auth-links a {
            color: #333;
            text-decoration: none;
            padding: 8px 15px;
            border-radius: 20px;
            transition: all 0.3s;
        }
        
        .auth-links a:hover {
            background: #f0f0f0;
            color: var(--accent-color, #ff6a00);
        }
        
        .account-button {
            display: flex;
            align-items: center;
            gap: 8px;
            background: linear-gradient(135deg, var(--accent-color, #ff6a00), #ff8c42);
            color: white;
            border: none;
            border-radius: 30px;
            padding: 10px 25px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .account-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 106, 0, 0.3);
        }
        
        /* Main Layout */
        .main-layout {
            display: flex;
            gap: 25px;
            margin-top: 25px;
        }
        
        /* Left Sidebar */
        .left-sidebar {
            width: 260px;
            background: linear-gradient(180deg, #fff, #f9f9f9);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            height: fit-content;
        }
        
        .category-header {
            background: linear-gradient(135deg, var(--accent-color, #ff6a00), #ff8c42);
            color: white;
            padding: 18px;
            font-weight: bold;
            text-align: center;
            font-family: 'Comfortaa', cursive;
            font-size: 16px;
            letter-spacing: 1px;
        }
        
        .category-list {
            list-style: none;
            padding: 15px 0;
            max-height: 500px;
            overflow-y: auto;
        }
        
        .category-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 20px;
            border-bottom: 1px solid #f0f0f0;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }
        
        .category-item:last-child {
            border-bottom: none;
        }
        
        .category-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 4px;
            background: var(--accent-color, #ff6a00);
            transform: translateX(-100%);
            transition: transform 0.3s;
        }
        
        .category-item:hover {
            background: linear-gradient(90deg, rgba(255, 106, 0, 0.05), transparent);
            padding-left: 25px;
        }
        
        .category-item:hover::before {
            transform: translateX(0);
        }
        
        .category-icon {
            width: 24px;
            text-align: center;
            color: var(--accent-color, #ff6a00);
            font-weight: bold;
            font-size: 18px;
        }
        
        .category-count {
            margin-left: auto;
            background: #f0f0f0;
            color: #666;
            font-size: 12px;
            padding: 3px 8px;
            border-radius: 10px;
            min-width: 30px;
            text-align: center;
        }
        
        /* Main Content */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 25px;
        }
        
        /* Hero Section */
        .hero-section {
            position: relative;
            border-radius: 16px;
            overflow: hidden;
            height: 320px;
            background: linear-gradient(90deg, #000 0%, rgba(0,0,0,0.8) 30%, transparent 100%), 
                        url('https://i.ibb.co/DDpVZx8W/Ingabo-store.png');
            background-size: cover;
            background-position: right center;
            background-repeat: no-repeat;
            display: flex;
            align-items: center;
            padding: 0 40px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .hero-overlay {
            max-width: 600px;
            color: white;
            position: relative;
            z-index: 2;
        }
        
        .hero-title {
            font-size: 36px;
            font-weight: bold;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            font-family: 'Comfortaa', cursive;
            line-height: 1.2;
        }
        
        .hero-subtitle {
            font-size: 16px;
            margin-bottom: 25px;
            line-height: 1.6;
            opacity: 0.9;
            max-width: 500px;
        }
        
        .hero-button {
            background: white;
            color: #000;
            border: none;
            border-radius: 30px;
            padding: 15px 30px;
            font-weight: bold;
            font-size: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
            font-family: 'Comfortaa', cursive;
        }
        
        .hero-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(255,255,255,0.3);
            background: var(--accent-color, #ff6a00);
            color: white;
        }
        
        .cinematic-fade {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, 
                rgba(0,0,0,0.8) 0%, 
                rgba(0,0,0,0.5) 20%, 
                transparent 40%,
                transparent 60%,
                rgba(0,0,0,0.5) 80%,
                rgba(0,0,0,0.8) 100%);
            animation: cinematicMove 8s ease-in-out infinite;
            z-index: 1;
        }
        
        @keyframes cinematicMove {
            0%, 100% {
                background-position: 0% 50%;
            }
            50% {
                background-position: 100% 50%;
            }
        }
        
        /* Product Categories */
        .product-categories {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            grid-template-rows: repeat(2, auto);
            gap: 15px;
            margin-top: 15px;
        }
        
        .category-card {
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            border-radius: 12px;
            padding: 20px;
            height: 140px;
            display: flex;
            align-items: flex-end;
            position: relative;
            cursor: pointer;
            overflow: hidden;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .category-card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 0;
            height: 0;
            border-style: solid;
            border-width: 0 30px 30px 0;
            border-color: transparent var(--accent-color, #ff6a00) transparent transparent;
            transition: all 0.3s;
        }
        
        .category-card::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to top, rgba(0,0,0,0.8), transparent 50%);
            z-index: 1;
            transition: all 0.3s;
        }
        
        .category-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 15px 35px rgba(0,0,0,0.2);
        }
        
        .category-card:hover::before {
            border-width: 0 35px 35px 0;
        }
        
        .category-card:hover::after {
            background: linear-gradient(to top, rgba(0,0,0,0.9), transparent 40%);
        }
        
        .category-name {
            font-weight: 600;
            font-size: 18px;
            color: white;
            z-index: 2;
            position: relative;
            font-family: 'Comfortaa', cursive;
        }
        
        /* Right Sidebar */
        .right-sidebar {
            width: 260px;
            display: flex;
            flex-direction: column;
            gap: 25px;
        }
        
        .account-area {
            background: linear-gradient(135deg, #fff 0%, #f9f9f9 100%);
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.08);
            text-align: center;
            border: 1px solid rgba(0,0,0,0.05);
        }
        
        .account-logo {
            width: 60px;
            height: 60px;
            margin: 0 auto 20px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--accent-color, #ff6a00), #ff8c42);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
        }
        
        .account-title {
            font-weight: 600;
            font-size: 18px;
            margin-bottom: 10px;
            color: #333;
            font-family: 'Comfortaa', cursive;
        }
        
        .user-greeting {
            font-size: 16px;
            color: #666;
            margin-bottom: 20px;
            min-height: 24px;
        }
        
        .account-buttons {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .login-button, .register-button {
            border: none;
            border-radius: 30px;
            padding: 14px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.3s;
            font-size: 15px;
            font-family: 'Comfortaa', cursive;
        }
        
        .login-button {
            background: linear-gradient(135deg, var(--accent-color, #ff6a00), #ff8c42);
            color: white;
        }
        
        .register-button {
            background: white;
            color: #333;
            border: 2px solid #e0e0e0;
        }
        
        .login-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(255, 106, 0, 0.3);
        }
        
        .register-button:hover {
            border-color: var(--accent-color, #ff6a00);
            color: var(--accent-color, #ff6a00);
            transform: translateY(-3px);
        }
        
        /* Top Picks Section */
        .top-picks-section {
            margin-top: 30px;
            background: linear-gradient(180deg, #fff, #f9f9f9);
            padding: 25px;
            border-radius: 16px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.05);
        }
        
        .section-title {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 25px;
        }
        
        .orange-dot {
            width: 14px;
            height: 14px;
            background: var(--accent-color, #ff6a00);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
                opacity: 1;
            }
            50% {
                transform: scale(1.2);
                opacity: 0.8;
            }
        }
        
        .section-title h2 {
            font-weight: 600;
            text-transform: uppercase;
            color: #333;
            font-size: 20px;
            font-family: 'Comfortaa', cursive;
        }
        
        .top-picks-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
        }
        
        .top-pick-card {
            background: white;
            border: 1px solid #e5e5e5;
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }
        
        .top-pick-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            border-color: var(--accent-color, #ff6a00);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .card-title {
            font-weight: 500;
            color: #333;
            font-size: 16px;
            font-weight: 600;
        }
        
        .view-all-link {
            color: #666;
            font-size: 13px;
            text-decoration: none;
            transition: color 0.3s;
        }
        
        .view-all-link:hover {
            color: var(--accent-color, #ff6a00);
        }
        
        .product-images {
            display: flex;
            gap: 10px;
            justify-content: space-between;
        }
        
        .product-image {
            width: 100%;
            aspect-ratio: 1;
            background: #f8f8f8;
            border: 1px solid #e5e5e5;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #999;
            font-size: 12px;
            flex: 1;
            overflow: hidden;
            cursor: pointer;
            position: relative;
            transition: all 0.3s;
        }
        
        .product-image:hover {
            border-color: var(--accent-color, #ff6a00);
        }
        
        .product-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }
        
        .product-image:hover img {
            transform: scale(1.1);
        }
        
        /* Today's Deal Section */
        .todays-deal-section {
            margin-top: 30px;
            background: linear-gradient(180deg, #fff, #f9f9f9);
            padding: 25px;
            border-radius: 16px;
            position: relative;
            box-shadow: 0 8px 25px rgba(0,0,0,0.05);
        }
        
        .deal-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 20px;
            margin-top: 20px;
        }
        
        .deal-card {
            background: white;
            border: 1px solid #e5e5e5;
            border-radius: 12px;
            padding: 15px;
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
            overflow: hidden;
        }
        
        .deal-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.15);
            border-color: var(--accent-color, #ff6a00);
        }
        
        .relevance-indicator {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 10px;
            height: 10px;
            background: #4CAF50;
            border-radius: 50%;
            display: none;
            box-shadow: 0 0 10px #4CAF50;
        }
        
        .relevance-indicator.show {
            display: block;
        }
        
        .discount-badge {
            position: absolute;
            top: 10px;
            left: 10px;
            background: linear-gradient(135deg, #ff0000, #ff6a6a);
            color: white;
            padding: 5px 10px;
            font-size: 12px;
            font-weight: bold;
            z-index: 1;
            border-radius: 4px;
        }
        
        .deal-image {
            width: 100%;
            height: 130px;
            background: #f8f8f8;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 15px;
            position: relative;
            overflow: hidden;
            border-radius: 8px;
        }
        
        .deal-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }
        
        .deal-card:hover .deal-image img {
            transform: scale(1.1);
        }
        
        .deal-img-placeholder {
            width: 80%;
            height: 80%;
            background: linear-gradient(135deg, #e0e0e0, #f0f0f0);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #999;
            font-size: 14px;
            border-radius: 8px;
        }
        
        .original-badge {
            position: absolute;
            bottom: 10px;
            right: 10px;
            background: linear-gradient(135deg, var(--accent-color, #ff6a00), #ff8c42);
            color: white;
            padding: 4px 8px;
            font-size: 11px;
            border-radius: 4px;
        }
        
        .deal-title {
            font-size: 13px;
            color: #333;
            margin-bottom: 10px;
            line-height: 1.4;
            height: 36px;
            overflow: hidden;
            font-weight: 500;
        }
        
        .deal-price {
            color: #ff0000;
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 5px;
        }
        
        .original-price {
            color: #888;
            font-size: 12px;
            text-decoration: line-through;
        }
        
        .navigation-button {
            position: absolute;
            right: 25px;
            top: 50%;
            transform: translateY(-50%);
            width: 50px;
            height: 50px;
            background: white;
            border: 2px solid #ddd;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 20px;
            color: #666;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .navigation-button:hover {
            border-color: var(--accent-color, #ff6a00);
            color: var(--accent-color, #ff6a00);
            transform: translateY(-50%) scale(1.1);
            box-shadow: 0 6px 20px rgba(255, 106, 0, 0.2);
        }
        
        /* Filter View */
        .filter-view {
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        .filter-view.active {
            display: block;
        }
        
        .filter-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 3px solid var(--accent-color, #ff6a00);
        }
        
        .filter-title {
            font-size: 24px;
            font-weight: bold;
            color: #333;
            display: flex;
            align-items: center;
            gap: 15px;
            font-family: 'Comfortaa', cursive;
        }
        
        .back-to-home {
            background: linear-gradient(135deg, var(--accent-color, #ff6a00), #ff8c42);
            color: white;
            border: none;
            border-radius: 30px;
            padding: 12px 25px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
        }
        
        .back-to-home:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(255, 106, 0, 0.3);
        }
        
        .filter-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 25px;
            margin-top: 25px;
        }
        
        .filter-product-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 8px 25px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
            position: relative;
        }
        
        .filter-product-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
        }
        
        .filter-product-image {
            width: 100%;
            height: 220px;
            overflow: hidden;
            background: #f8f8f8;
        }
        
        .filter-product-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }
        
        .filter-product-card:hover .filter-product-image img {
            transform: scale(1.1);
        }
        
        .filter-product-info {
            padding: 20px;
        }
        
        .filter-product-name {
            font-size: 15px;
            font-weight: 600;
            margin-bottom: 10px;
            color: #333;
            line-height: 1.4;
            height: 42px;
            overflow: hidden;
        }
        
        .filter-product-price {
            color: var(--accent-color, #ff6a00);
            font-weight: bold;
            font-size: 18px;
        }
        
        /* Loading State */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 200px;
            font-size: 16px;
            color: #666;
            flex-direction: column;
            gap: 15px;
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--accent-color, #ff6a00);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @keyframes fadeIn {
            from { 
                opacity: 0; 
                transform: translateY(20px);
            }
            to { 
                opacity: 1; 
                transform: translateY(0);
            }
        }
        
        /* Footer Sections */
        .footer-sections {
            margin-top: 40px;
            background: linear-gradient(180deg, #fff, #f9f9f9);
            padding: 40px;
            border-radius: 20px;
            border-top: 3px solid var(--accent-color, #ff6a00);
            box-shadow: 0 -5px 25px rgba(0,0,0,0.05);
        }
        
        .footer-columns {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 40px;
        }
        
        .footer-column {
            padding: 15px;
        }
        
        .footer-title {
            font-weight: 600;
            font-size: 18px;
            margin-bottom: 20px;
            color: #333;
            font-family: 'Comfortaa', cursive;
            position: relative;
            padding-bottom: 10px;
        }
        
        .footer-title::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 40px;
            height: 3px;
            background: var(--accent-color, #ff6a00);
            border-radius: 2px;
        }
        
        .subscription-form {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 15px;
        }
        
        .email-input {
            flex: 1;
            padding: 14px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .email-input:focus {
            outline: none;
            border-color: var(--accent-color, #ff6a00);
            box-shadow: 0 0 0 3px rgba(255, 106, 0, 0.1);
        }
        
        .subscribe-button {
            background: linear-gradient(135deg, var(--accent-color, #ff6a00), #ff8c42);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Comfortaa', cursive;
        }
        
        .subscribe-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(255, 106, 0, 0.3);
        }
        
        .helper-text {
            font-size: 13px;
            color: #666;
            line-height: 1.5;
        }
        
        .sell-text {
            font-size: 15px;
            color: #333;
            margin-bottom: 10px;
            font-weight: 500;
        }
        
        .join-text {
            color: var(--accent-color, #ff6a00);
            font-weight: 600;
            font-size: 15px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: gap 0.3s;
        }
        
        .join-text:hover {
            gap: 12px;
        }
        
        .social-icons {
            display: flex;
            gap: 15px;
            margin-top: 15px;
        }
        
        .social-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
            text-decoration: none;
            transition: all 0.3s;
            background: #333;
        }
        
        .social-icon:hover {
            transform: translateY(-5px) rotate(10deg);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }
        
        .social-icon.facebook { background: #1877F2; }
        .social-icon.twitter { background: #1DA1F2; }
        .social-icon.whatsapp { background: #25D366; }
        .social-icon.instagram { 
            background: linear-gradient(45deg, #405DE6, #5851DB, #833AB4, #C13584, #E1306C, #FD1D1D);
        }
        
        /* Footer Links */
        .footer-links {
            margin-top: 40px;
            background: linear-gradient(180deg, #fff, #f8f8f8);
            padding: 40px;
            border-radius: 20px;
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 40px;
            box-shadow: 0 5px 25px rgba(0,0,0,0.05);
        }
        
        .links-column h3 {
            font-weight: 600;
            font-size: 18px;
            margin-bottom: 20px;
            color: #333;
            font-family: 'Comfortaa', cursive;
            position: relative;
            padding-bottom: 10px;
        }
        
        .links-column h3::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 30px;
            height: 3px;
            background: var(--accent-color, #ff6a00);
            border-radius: 2px;
        }
        
        .links-list {
            list-style: none;
        }
        
        .links-list li {
            margin-bottom: 12px;
        }
        
        .links-list a {
            color: #666;
            text-decoration: none;
            font-size: 14px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .links-list a:hover {
            color: var(--accent-color, #ff6a00);
            padding-left: 5px;
        }
        
        .contact-info {
            font-size: 14px;
            color: #666;
            line-height: 1.8;
        }
        
        .contact-item {
            margin-bottom: 15px;
            display: flex;
            align-items: flex-start;
            gap: 10px;
            cursor: pointer;
            transition: color 0.3s;
        }
        
        .contact-item:hover {
            color: var(--accent-color, #ff6a00);
        }
        
        .contact-item i {
            margin-top: 3px;
            color: var(--accent-color, #ff6a00);
        }
        
        /* Audio Player (Hidden) */
        .audio-player {
            display: none;
        }
        
        /* Mobile Redirection */
        @media (max-width: 768px) {
            .mobile-redirect-overlay {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: white;
                z-index: 999999;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                padding: 20px;
                text-align: center;
            }
            
            .mobile-redirect-overlay h2 {
                font-family: 'Comfortaa', cursive;
                margin-bottom: 20px;
                color: #333;
            }
            
            .redirect-button {
                background: var(--accent-color, #ff6a00);
                color: white;
                border: none;
                border-radius: 30px;
                padding: 15px 30px;
                font-weight: bold;
                cursor: pointer;
                margin: 10px;
                font-family: 'Comfortaa', cursive;
            }
        }
    </style>
</head>
<body>
    <!-- Audio Players -->
    <audio id="morningAudio" class="audio-player" preload="auto">
        <source src="Assets/audios/morning.mp3" type="audio/mpeg">
    </audio>
    <audio id="afternoonAudio" class="audio-player" preload="auto">
        <source src="Assets/audios/afternoon.mp3" type="audio/mpeg">
    </audio>
    <audio id="eveningAudio" class="audio-player" preload="auto">
        <source src="Assets/audios/evening.mp3" type="audio/mpeg">
    </audio>
    
    <!-- Paused Mode Overlay -->
    <div class="paused-overlay" id="pausedOverlay">
        <div>
            <i class='bx bx-pause-circle' style="font-size: 60px; margin-bottom: 20px;"></i>
            <div style="font-size: 36px; margin-bottom: 15px;">WEBSITE IS TEMPORARILY PAUSED</div>
            <div style="font-size: 18px; opacity: 0.8;">PLEASE CHECK BACK SOON</div>
        </div>
    </div>
    
    <!-- Cart Overlay -->
    <div class="cart-overlay" id="cartOverlay"></div>
    
    <!-- Cart Sidebar -->
    <div class="cart-sidebar" id="cartSidebar">
        <div class="cart-header">
            <div class="cart-title">Your Shopping Cart</div>
            <button class="close-cart" id="closeCart">Ã—</button>
        </div>
        <div class="cart-items-container" id="cartItemsContainer">
            <!-- Cart items will be loaded here -->
        </div>
    </div>
    
    <!-- Announcement Banner -->
    <div class="announcement-banner" id="announcementBanner">
        <div class="announcement-content" id="announcementContent"></div>
    </div>
    
    <div class="container">
        <!-- Top Header -->
        <header class="top-header">
            <div class="header-content">
                <div class="logo-area" onclick="window.location.href='index.html'">
                    <img src="https://i.ibb.co/1fjd5Ncn/logo.png" alt="INGABO Logo" class="logo-img">
                    <div class="logo-text">
                        <h1>INGABO</h1>
                        <span>Online shop</span>
                    </div>
                </div>
                
                <div class="search-area">
                    <input type="text" class="search-bar" placeholder="What are you looking for?" id="searchInput">
                    <button class="search-button" id="searchButton">
                        <i class='bx bx-search'></i> Search
                    </button>
                    <div class="search-results" id="searchResults">
                        <!-- Search results will be loaded here -->
                    </div>
                </div>
                
                <div class="header-right">
                    <button class="cart-button" id="cartButton">
                        <i class='bx bx-cart'></i>
                        <span>Cart</span>
                        <span class="cart-count" id="cartCount">0</span>
                    </button>
                    <div class="auth-links" id="authLinks">
                        <!-- Dynamic auth links -->
                    </div>
                </div>
            </div>
        </header>
        
        <!-- Main Layout -->
        <div class="main-layout">
            <!-- Left Sidebar -->
            <aside class="left-sidebar">
                <div class="category-header">Shop by Category</div>
                <ul class="category-list" id="categoryList">
                    <!-- Categories will be loaded from Firebase -->
                </ul>
            </aside>
            
            <!-- Main Content -->
            <main class="main-content" id="mainContent">
                <!-- Normal View -->
                <div id="normalView">
                    <!-- Hero Section -->
                    <section class="hero-section" id="heroSection">
                        <div class="cinematic-fade"></div>
                        <div class="hero-overlay">
                            <div class="hero-title">Start an online store for free.</div>
                            <div class="hero-subtitle">
                                INGABO is the all-in-one platform to build, run, and grow your online boutique. 
                                Start free, then get 3 months for $1/month
                            </div>
                            <button class="hero-button" id="heroButton" onclick="window.open('https://docs.google.com/forms/d/e/1FAIpQLSdK3c9V1kEBZcWo0tWLVVomlb_vOiVmLjXoHkDFMeN-6Q_fcA/viewform?usp=dialog', '_blank')">
                                JOIN THE WAITLIST <i class='bx bx-chevron-right'></i>
                            </button>
                        </div>
                    </section>
                    
                    <!-- Product Categories -->
                    <div class="product-categories" id="productCategories">
                        <!-- Category cards will be loaded from Firebase -->
                    </div>
                    
                    <!-- Top Picks Section -->
                    <section class="top-picks-section" id="topPicksSection">
                        <div class="section-title">
                            <div class="orange-dot"></div>
                            <h2>INGABO TOP PICKS</h2>
                        </div>
                        
                        <div class="top-picks-grid" id="topPicksGrid">
                            <!-- Top picks will be loaded from Firebase -->
                        </div>
                    </section>
                    
                    <!-- Today's Deal Section -->
                    <section class="todays-deal-section" id="todaysDealSection">
                        <div class="section-title">
                            <div class="orange-dot"></div>
                            <h2>Personalized Recommendations</h2>
                        </div>
                        
                        <div class="deal-grid" id="dealGrid">
                            <!-- Personalized products will be loaded from Firebase -->
                        </div>
                        
                        <div class="navigation-button" id="nextButton"><i class='bx bx-chevron-right'></i></div>
                    </section>
                    
                    <!-- Footer Sections -->
                    <div class="footer-sections" id="footerSections">
                        <div class="footer-columns">
                            <div class="footer-column">
                                <div class="footer-title">Subscription</div>
                                <div class="subscription-form">
                                    <input type="email" class="email-input" id="subscribeEmail" placeholder="Please enter your email">
                                    <button class="subscribe-button" id="subscribeButton">Subscribe</button>
                                </div>
                                <div class="helper-text">Register now for updates on promotions and coupons</div>
                            </div>
                            
                            <div class="footer-column">
                                <div class="footer-title">Sell on INGABO</div>
                                <div class="sell-text">Join us</div>
                                <div class="join-text" onclick="window.open('https://docs.google.com/forms/d/e/1FAIpQLSdK3c9V1kEBZcWo0tWLVVomlb_vOiVmLjXoHkDFMeN-6Q_fcA/viewform?usp=dialog', '_blank')">
                                    Join Us <i class='bx bx-right-arrow-alt'></i>
                                </div>
                            </div>
                            
                            <div class="footer-column">
                                <div class="footer-title">Stay Connected</div>
                                <div class="social-icons">
                                    <a href="https://facebook.com" target="_blank" class="social-icon facebook">
                                        <i class='bx bxl-facebook'></i>
                                    </a>
                                    <a href="https://twitter.com" target="_blank" class="social-icon twitter">
                                        <i class='bx bxl-twitter'></i>
                                    </a>
                                    <a href="https://wa.me" target="_blank" class="social-icon whatsapp">
                                        <i class='bx bxl-whatsapp'></i>
                                    </a>
                                    <a href="https://instagram.com" target="_blank" class="social-icon instagram">
                                        <i class='bx bxl-instagram'></i>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Footer Links -->
                    <div class="footer-links" id="footerLinks">
                        <div class="links-column">
                            <h3>FAQs</h3>
                            <ul class="links-list">
                                <li><a href="faqs.html"><i class='bx bx-chevron-right'></i> Shipping information</a></li>
                                <li><a href="faqs.html"><i class='bx bx-chevron-right'></i> How to buy</a></li>
                                <li><a href="faqs.html"><i class='bx bx-chevron-right'></i> How to pay</a></li>
                                <li><a href="faqs.html"><i class='bx bx-chevron-right'></i> Return policy</a></li>
                                <li><a href="faqs.html"><i class='bx bx-chevron-right'></i> Terms</a></li>
                                <li><a href="faqs.html"><i class='bx bx-chevron-right'></i> Contact support</a></li>
                            </ul>
                        </div>
                        
                        <div class="links-column">
                            <h3>Browse by Category</h3>
                            <ul class="links-list" id="categoryLinks">
                                <!-- Dynamic categories -->
                            </ul>
                        </div>
                        
                        <div class="links-column">
                            <h3>About</h3>
                            <ul class="links-list">
                                <li><a href="privacy.html"><i class='bx bx-chevron-right'></i> Privacy Policy</a></li>
                            </ul>
                        </div>
                        
                        <div class="links-column">
                            <h3>Contact Us</h3>
                            <div class="contact-info">
                                <div class="contact-item" onclick="copyToClipboard('RWANDA-KICUKIRO')">
                                    <i class='bx bx-map'></i>
                                    <div>Address: RWANDA-KICUKIRO</div>
                                </div>
                                <div class="contact-item" onclick="copyToClipboard('+250 782 520 531')">
                                    <i class='bx bx-phone'></i>
                                    <div>Phone number: +250 782 520 531</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Filter View (hidden by default) -->
                <div class="filter-view" id="filterView">
                    <div class="filter-header">
                        <div class="filter-title">
                            <i class='bx bx-filter-alt'></i>
                            <span id="filterTitle">Products</span>
                        </div>
                        <button class="back-to-home" id="backToHome">
                            <i class='bx bx-home'></i> Back to Home
                        </button>
                    </div>
                    
                    <div class="filter-grid" id="filterGrid">
                        <!-- Filtered products will be loaded here -->
                    </div>
                </div>
            </main>
            
            <!-- Right Sidebar -->
            <aside class="right-sidebar" id="rightSidebar">
                <div class="account-area">
                    <div class="account-logo">
                        <i class='bx bx-store-alt'></i>
                    </div>
                    <div class="account-title" id="userGreeting">Welcome to INGABO</div>
                    <div class="user-greeting" id="userNameDisplay"></div>
                    <div class="account-buttons" id="accountButtons">
                        <!-- Dynamic account buttons -->
                    </div>
                </div>
            </aside>
        </div>
    </div>

    <script>
        // ==================== ENCRYPTED CONFIGURATION ====================
        (function() {
            // Obfuscated configuration
            const _0x1a2b3c = ['firebasestorage', '1059301382626', 'initializeApp', 'auth', 'firestore', 'analytics', 'measurementId'];
            const _0x4d5e6f = 'AIzaSyAQsQAEGPdFY2gKRBpC3crZTSEzUGQ4CKE';
            const _0x7a8b9c = 'ingabo-store';
            
            window._fbc = {
                aK: _0x4d5e6f,
                aD: _0x7a8b9c + '.firebaseapp.com',
                pI: _0x7a8b9c,
                sB: _0x7a8b9c + '.appspot.com',
                mS: _0x1a2b3c[1],
                aI: '1:' + _0x1a2b3c[1] + ':web:98f0a8cebbeccbc21f41bb',
                mI: 'G-QSXTGP9R1Q'
            };
        })();

        // ==================== FIREBASE INITIALIZATION ====================
        const firebaseConfig = {
            apiKey: window._fbc.aK,
            authDomain: window._fbc.aD,
            projectId: window._fbc.pI,
            storageBucket: window._fbc.sB,
            messagingSenderId: window._fbc.mS,
            appId: window._fbc.aI,
            measurementId: window._fbc.mI
        };

        // Initialize Firebase with error handling
        let app, auth, db, analytics;
        try {
            app = firebase.initializeApp(firebaseConfig);
            auth = firebase.auth();
            db = firebase.firestore();
            analytics = firebase.analytics();
        } catch (error) {
            console.error('Firebase initialization error:', error);
        }

        // ==================== GLOBAL VARIABLES ====================
        let currentUser = null;
        let userPersonalCode = '';
        let allProducts = [];
        let sitePersonalization = null;
        let currentDealPage = 0;
        let searchTimer = null;
        let cartItems = JSON.parse(localStorage.getItem('ingabo_cart') || '[]');
        const dealsPerPage = 10;
        let currentHour = new Date().getHours();
        let playedAudio = localStorage.getItem('played_audio') || '';
        let accentColorInterval = null;
        let accentColors = ['#ff6a00', '#8a2be2', '#2ecc71', '#3498db']; // Orange, Violet, Green, Blue

        // ==================== UTILITY FUNCTIONS ====================
        function _0x3d8a7f(price) {
            return price.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }

        function _0x5b9c2e(text) {
            return text.split('').reverse().join('');
        }

        // ==================== INITIALIZATION ====================
        document.addEventListener('DOMContentLoaded', function() {
            // Check screen size for mobile redirect
            if (window.innerWidth <= 768) {
                window.location.href = 'indexp.html';
                return;
            }
            
            // Initialize accent color rotation
            initializeAccentColor();
            
            // Play time-based audio
            playTimeBasedAudio();
            
            // Initialize all components
            initializeApp();
        });

        // ==================== ACCENT COLOR ROTATION ====================
        function initializeAccentColor() {
            // Set initial color based on hour
            const hour = new Date().getHours();
            const colorIndex = hour % accentColors.length;
            updateAccentColor(accentColors[colorIndex]);
            
            // Change color every hour
            accentColorInterval = setInterval(() => {
                const currentTime = new Date().getHours();
                if (currentTime !== currentHour) {
                    currentHour = currentTime;
                    const newColorIndex = currentHour % accentColors.length;
                    updateAccentColor(accentColors[newColorIndex]);
                }
            }, 600000); // Check every 10 minutes
        }

        function updateAccentColor(color) {
            document.documentElement.style.setProperty('--accent-color', color);
            
            // Update all elements with accent color
            const elements = document.querySelectorAll('[style*="accent-color"]');
            elements.forEach(el => {
                const style = el.getAttribute('style');
                const newStyle = style.replace(/#[0-9a-f]{6}/gi, color);
                el.setAttribute('style', newStyle);
            });
        }

        // ==================== TIME-BASED AUDIO PLAYER ====================
        function playTimeBasedAudio() {
            const hour = new Date().getHours();
            let audioToPlay = '';
            
            // Determine which audio to play based on time
            if (hour >= 5 && hour < 12) {
                audioToPlay = 'morning';
            } else if (hour >= 12 && hour < 18) {
                audioToPlay = 'afternoon';
            } else {
                audioToPlay = 'evening';
            }
            
            // Check if audio was already played for this time period
            const lastPlayed = localStorage.getItem('last_audio_played');
            const lastPlayTime = localStorage.getItem('last_play_time');
            const currentTime = new Date().toISOString().split('T')[0] + '-' + Math.floor(hour / 6);
            
            if (lastPlayed !== audioToPlay || lastPlayTime !== currentTime) {
                const audioElement = document.getElementById(audioToPlay + 'Audio');
                if (audioElement) {
                    audioElement.volume = 1.0;
                    audioElement.play().catch(e => console.log('Audio play failed:', e));
                    
                    // Store playback info
                    localStorage.setItem('last_audio_played', audioToPlay);
                    localStorage.setItem('last_play_time', currentTime);
                }
            }
        }

        // ==================== CART FUNCTIONALITY ====================
        function initializeCart() {
            const cartButton = document.getElementById('cartButton');
            const closeCart = document.getElementById('closeCart');
            const cartOverlay = document.getElementById('cartOverlay');
            const cartSidebar = document.getElementById('cartSidebar');
            
            cartButton.addEventListener('click', showCart);
            closeCart.addEventListener('click', hideCart);
            cartOverlay.addEventListener('click', hideCart);
            
            updateCartCount();
        }

        function showCart() {
            document.getElementById('cartOverlay').classList.add('active');
            document.getElementById('cartSidebar').classList.add('active');
            loadCartItems();
        }

        function hideCart() {
            document.getElementById('cartOverlay').classList.remove('active');
            document.getElementById('cartSidebar').classList.remove('active');
        }

        function loadCartItems() {
            const container = document.getElementById('cartItemsContainer');
            
            if (cartItems.length === 0) {
                container.innerHTML = `
                    <div class="empty-cart">
                        <i class='bx bx-cart'></i>
                        <div>Your cart is empty</div>
                        <div style="font-size: 14px; color: #aaa; margin-top: 10px;">Add some items to get started!</div>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = '';
            cartItems.forEach(item => {
                const cartItem = document.createElement('div');
                cartItem.className = 'cart-item';
                cartItem.innerHTML = `
                    <div class="cart-item-image">
                        ${item.image ? 
                            `<img src="${item.image}" alt="${item.name}">` : 
                            `<i class='bx bx-image'></i>`
                        }
                    </div>
                    <div class="cart-item-info">
                        <div class="cart-item-name">${item.name}</div>
                        <div class="cart-item-price">${_0x3d8a7f(item.price)} RWF</div>
                        <div class="cart-item-quantity">Quantity: ${item.quantity || 1}</div>
                    </div>
                `;
                
                cartItem.addEventListener('click', () => {
                    window.location.href = `view.html?id=${item.id}`;
                    hideCart();
                });
                
                container.appendChild(cartItem);
            });
        }

        function updateCartCount() {
            const totalItems = cartItems.reduce((sum, item) => sum + (item.quantity || 1), 0);
            document.getElementById('cartCount').textContent = totalItems;
        }

        // ==================== AUTHENTICATION MANAGEMENT ====================
        function initializeAuth() {
            auth.onAuthStateChanged(async (user) => {
                currentUser = user;
                updateAuthUI(user);
                
                if (user) {
                    try {
                        const userDoc = await db.collection('users').doc(user.uid).get();
                        if (userDoc.exists) {
                            const userData = userDoc.data();
                            userPersonalCode = generatePersonalCode(userData);
                            
                            // Update user greeting
                            const displayName = userData.firstName || userData.displayName || user.email.split('@')[0];
                            document.getElementById('userNameDisplay').textContent = `Welcome, ${displayName}`;
                        }
                    } catch (error) {
                        console.error('Error loading user data:', error);
                    }
                } else {
                    userPersonalCode = 'GUEST-CODE';
                    document.getElementById('userNameDisplay').textContent = '';
                }
                
                // Load personalized content
                loadPersonalizedDeals();
            });
        }

        function updateAuthUI(user) {
            const authLinks = document.getElementById('authLinks');
            const accountButtons = document.getElementById('accountButtons');
            
            if (user) {
                // User is logged in - show Account button only
                authLinks.innerHTML = `
                    <button class="account-button" onclick="window.location.href='account.html'">
                        <i class='bx bx-user'></i> Account
                    </button>
                `;
                
                accountButtons.innerHTML = `
                    <button class="account-button" onclick="window.location.href='account.html'">
                        <i class='bx bx-user'></i> Account
                    </button>
                `;
            } else {
                // User is not logged in - show Sign in and Register
                authLinks.innerHTML = `
                    <a href="login.html"><i class='bx bx-user'></i> Sign in</a>
                    <a href="login.html?register=true"><i class='bx bx-user-plus'></i> Register</a>
                `;
                
                accountButtons.innerHTML = `
                    <a href="login.html" class="login-button">
                        <i class='bx bx-user'></i> Sign in
                    </a>
                    <a href="login.html?register=true" class="register-button">
                        <i class='bx bx-user-plus'></i> Register
                    </a>
                `;
            }
        }

        // ==================== CATEGORY LOADING ====================
        async function loadCategories() {
            try {
                // First, get all active products to count categories
                const productsSnapshot = await db.collection('products')
                    .where('active', '==', true)
                    .get();
                
                // Count products per category
                const categoryCounts = {};
                productsSnapshot.forEach(doc => {
                    const product = doc.data();
                    if (product.category) {
                        categoryCounts[product.category] = (categoryCounts[product.category] || 0) + 1;
                    }
                });
                
                // Get unique categories from products
                const uniqueCategories = [...new Set(productsSnapshot.docs.map(doc => doc.data().category))];
                
                const categoryList = document.getElementById('categoryList');
                const categoryLinks = document.getElementById('categoryLinks');
                
                categoryList.innerHTML = '';
                categoryLinks.innerHTML = '';
                
                // Create category items
                uniqueCategories.forEach(category => {
                    if (!category) return;
                    
                    const count = categoryCounts[category] || 0;
                    
                    // Main category list
                    const li = document.createElement('li');
                    li.className = 'category-item';
                    li.innerHTML = `
                        <i class='bx bx-category category-icon'></i>
                        <span>${category}</span>
                        <span class="category-count">${count}</span>
                    `;
                    li.addEventListener('click', () => showFilteredProducts(category, 'category'));
                    categoryList.appendChild(li);
                    
                    // Footer category links
                    const linkLi = document.createElement('li');
                    linkLi.innerHTML = `
                        <a href="#" data-category="${category}">
                            <i class='bx bx-chevron-right'></i> ${category}
                        </a>
                    `;
                    linkLi.querySelector('a').addEventListener('click', (e) => {
                        e.preventDefault();
                        showFilteredProducts(category, 'category');
                    });
                    categoryLinks.appendChild(linkLi);
                });
                
                // Load featured categories
                loadFeaturedCategories(uniqueCategories);
            } catch (error) {
                console.error('Error loading categories:', error);
            }
        }

        async function loadFeaturedCategories(categories) {
            try {
                const container = document.getElementById('productCategories');
                container.innerHTML = '';
                
                // Use first 4 categories or all if less than 4
                const featuredCategories = categories.slice(0, 4);
                
                featuredCategories.forEach((category, index) => {
                    // Get sample product image for this category
                    db.collection('products')
                        .where('active', '==', true)
                        .where('category', '==', category)
                        .limit(1)
                        .get()
                        .then(snapshot => {
                            let imageUrl = 'https://images.unsplash.com/photo-1556742049-0cfed4f6a45d?auto=format&fit=crop&w=800';
                            
                            if (!snapshot.empty) {
                                const product = snapshot.docs[0].data();
                                if (product.images && product.images[0]) {
                                    imageUrl = product.images[0];
                                }
                            }
                            
                            const card = document.createElement('div');
                            card.className = 'category-card';
                            card.style.backgroundImage = `url('${imageUrl}')`;
                            card.innerHTML = `<div class="category-name">${category}</div>`;
                            card.addEventListener('click', () => showFilteredProducts(category, 'category'));
                            container.appendChild(card);
                        });
                });
            } catch (error) {
                console.error('Error loading featured categories:', error);
            }
        }

        // ==================== SEARCH FUNCTIONALITY ====================
        function initializeSearch() {
            const searchInput = document.getElementById('searchInput');
            const searchButton = document.getElementById('searchButton');
            
            searchInput.addEventListener('input', function() {
                clearTimeout(searchTimer);
                
                const query = this.value.trim();
                
                if (query.length < 2) {
                    document.getElementById('searchResults').classList.remove('active');
                    return;
                }
                
                searchTimer = setTimeout(() => {
                    performSearch(query);
                }, 300);
            });
            
            searchInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    const query = this.value.trim();
                    if (query) {
                        showFilteredProducts(query, 'search');
                    }
                }
            });
            
            searchButton.addEventListener('click', function() {
                const query = searchInput.value.trim();
                if (query) {
                    showFilteredProducts(query, 'search');
                }
            });
            
            // Close search results when clicking outside
            document.addEventListener('click', function(e) {
                const searchResults = document.getElementById('searchResults');
                if (!searchResults.contains(e.target) && e.target !== searchInput && e.target !== searchButton) {
                    searchResults.classList.remove('active');
                }
            });
        }

        async function performSearch(query) {
            const searchResults = document.getElementById('searchResults');
            
            try {
                const productsSnapshot = await db.collection('products')
                    .where('active', '==', true)
                    .limit(20)
                    .get();
                
                const results = [];
                const queryLower = query.toLowerCase();
                
                productsSnapshot.forEach(doc => {
                    const product = doc.data();
                    product.id = doc.id;
                    
                    if (product.name.toLowerCase().includes(queryLower) ||
                        (product.description && product.description.toLowerCase().includes(queryLower)) ||
                        product.category.toLowerCase().includes(queryLower)) {
                        results.push(product);
                    }
                });
                
                displaySearchResults(results, query);
            } catch (error) {
                console.error('Search error:', error);
            }
        }

        function displaySearchResults(results, query) {
            const searchResults = document.getElementById('searchResults');
            
            if (results.length === 0) {
                searchResults.innerHTML = `
                    <div class="no-results">
                        <i class='bx bx-search-alt'></i>
                        <div>No results found for "${query}"</div>
                    </div>
                `;
            } else {
                searchResults.innerHTML = '';
                
                // Display search results
                results.slice(0, 6).forEach(product => {
                    const item = document.createElement('div');
                    item.className = 'search-result-item';
                    item.innerHTML = `
                        ${product.images && product.images[0] ? 
                            `<img src="${product.images[0]}" class="search-result-img" alt="${product.name}">` : 
                            `<div class="search-result-img" style="background: #f0f0f0; display: flex; align-items: center; justify-content: center;">
                                <i class='bx bx-image'></i>
                            </div>`
                        }
                        <div class="search-result-info">
                            <div class="search-result-name">${product.name}</div>
                            <div style="display: flex; align-items: center;">
                                <span class="search-result-price">${_0x3d8a7f(product.price)} RWF</span>
                                <span class="search-result-category">${product.category}</span>
                            </div>
                        </div>
                    `;
                    
                    item.addEventListener('click', () => {
                        window.location.href = `view.html?id=${product.id}`;
                        searchResults.classList.remove('active');
                    });
                    
                    searchResults.appendChild(item);
                });
                
                // Add "Also you may like" section
                if (results.length > 0) {
                    loadAlsoYouMayLike(results[0].category, searchResults);
                }
            }
            
            searchResults.classList.add('active');
        }

        async function loadAlsoYouMayLike(category, container) {
            try {
                const alsoLikeSection = document.createElement('div');
                alsoLikeSection.className = 'also-like-section';
                alsoLikeSection.innerHTML = `
                    <div class="also-like-title">Also you may like:</div>
                    <div class="also-like-grid" id="alsoLikeGrid"></div>
                `;
                container.appendChild(alsoLikeSection);
                
                // Get random products from same category or random products
                const snapshot = await db.collection('products')
                    .where('active', '==', true)
                    .where('category', '==', category)
                    .limit(8)
                    .get();
                
                const products = [];
                snapshot.forEach(doc => {
                    const product = doc.data();
                    product.id = doc.id;
                    products.push(product);
                });
                
                // If not enough products in same category, get random products
                if (products.length < 4) {
                    const randomSnapshot = await db.collection('products')
                        .where('active', '==', true)
                        .limit(8)
                        .get();
                    
                    randomSnapshot.forEach(doc => {
                        if (products.length < 8) {
                            const product = doc.data();
                            product.id = doc.id;
                            if (!products.find(p => p.id === product.id)) {
                                products.push(product);
                            }
                        }
                    });
                }
                
                const alsoLikeGrid = document.getElementById('alsoLikeGrid');
                products.slice(0, 4).forEach(product => {
                    const item = document.createElement('div');
                    item.className = 'also-like-item';
                    item.innerHTML = `
                        <div style="font-size: 12px; font-weight: 500; margin-bottom: 5px;">${product.name.substring(0, 30)}${product.name.length > 30 ? '...' : ''}</div>
                        <div style="font-size: 14px; color: var(--accent-color, #ff6a00); font-weight: bold;">${_0x3d8a7f(product.price)} RWF</div>
                    `;
                    
                    item.addEventListener('click', () => {
                        window.location.href = `view.html?id=${product.id}`;
                        document.getElementById('searchResults').classList.remove('active');
                    });
                    
                    alsoLikeGrid.appendChild(item);
                });
            } catch (error) {
                console.error('Error loading also like:', error);
            }
        }

        // ==================== FILTER VIEW ====================
        function showFilteredProducts(filter, type) {
            const normalView = document.getElementById('normalView');
            const filterView = document.getElementById('filterView');
            const filterTitle = document.getElementById('filterTitle');
            
            normalView.style.display = 'none';
            filterView.classList.add('active');
            
            if (type === 'category') {
                filterTitle.textContent = `${filter} Products`;
            } else if (type === 'search') {
                filterTitle.textContent = `Search Results for "${filter}"`;
            }
            
            loadFilteredProducts(filter, type);
        }

        async function loadFilteredProducts(filter, type) {
            const container = document.getElementById('filterGrid');
            container.innerHTML = '<div class="loading"><div class="loading-spinner"></div>Loading products...</div>';
            
            try {
                let query = db.collection('products').where('active', '==', true);
                
                if (type === 'category') {
                    query = query.where('category', '==', filter);
                }
                
                const snapshot = await query.get();
                const products = [];
                
                snapshot.forEach(doc => {
                    const product = doc.data();
                    product.id = doc.id;
                    products.push(product);
                });
                
                // If search type, filter by text
                let filteredProducts = products;
                if (type === 'search') {
                    const filterLower = filter.toLowerCase();
                    filteredProducts = products.filter(product => 
                        product.name.toLowerCase().includes(filterLower) ||
                        (product.description && product.description.toLowerCase().includes(filterLower)) ||
                        product.category.toLowerCase().includes(filterLower)
                    );
                }
                
                displayFilteredProducts(filteredProducts, container);
            } catch (error) {
                console.error('Error loading filtered products:', error);
                container.innerHTML = '<div style="text-align: center; padding: 40px; color: #888;">Error loading products</div>';
            }
        }

        function displayFilteredProducts(products, container) {
            container.innerHTML = '';
            
            if (products.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 40px; color: #888;">No products found</div>';
                return;
            }
            
            products.forEach(product => {
                const card = document.createElement('div');
                card.className = 'filter-product-card';
                card.innerHTML = `
                    <div class="filter-product-image">
                        ${product.images && product.images[0] ? 
                            `<img src="${product.images[0]}" alt="${product.name}">` : 
                            `<div style="width: 100%; height: 100%; background: #f0f0f0; display: flex; align-items: center; justify-content: center;">
                                <i class='bx bx-image'></i>
                            </div>`
                        }
                    </div>
                    <div class="filter-product-info">
                        <div class="filter-product-name">${product.name}</div>
                        <div class="filter-product-price">${_0x3d8a7f(product.price)} RWF</div>
                    </div>
                `;
                
                card.addEventListener('click', () => {
                    window.location.href = `view.html?id=${product.id}`;
                });
                
                container.appendChild(card);
            });
        }

        // ==================== SUBSCRIPTION ====================
        function initializeSubscription() {
            const subscribeButton = document.getElementById('subscribeButton');
            const emailInput = document.getElementById('subscribeEmail');
            
            subscribeButton.addEventListener('click', async () => {
                const email = emailInput.value.trim();
                
                if (!email || !validateEmail(email)) {
                    alert('Please enter a valid email address');
                    return;
                }
                
                try {
                    await db.collection('subscriptions').add({
                        email: email,
                        subscribedAt: firebase.firestore.FieldValue.serverTimestamp(),
                        source: 'footer'
                    });
                    
                    alert('Thank you for subscribing!');
                    emailInput.value = '';
                } catch (error) {
                    console.error('Subscription error:', error);
                    alert('Failed to subscribe. Please try again.');
                }
            });
        }

        function validateEmail(email) {
            const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return re.test(email);
        }

        // ==================== COPY TO CLIPBOARD ====================
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                // Show temporary notification
                const notification = document.createElement('div');
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: var(--accent-color, #ff6a00);
                    color: white;
                    padding: 12px 20px;
                    border-radius: 8px;
                    z-index: 10000;
                    animation: slideIn 0.3s ease;
                    font-family: 'Comfortaa', cursive;
                `;
                notification.textContent = 'Copied to clipboard!';
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.style.animation = 'slideOut 0.3s ease';
                    setTimeout(() => notification.remove(), 300);
                }, 2000);
            }).catch(err => {
                console.error('Copy failed:', err);
            });
        }

        // ==================== PERSONALIZATION ALGORITHM ====================
        const metricMappings = {
            category: {
                'Shoes': 'A', 'T-shirts': 'B', 'Pants': 'C',
                'Watches': 'D', 'Necklace': 'E', 'Bracelets': 'F', 'Caps': 'G'
            },
            department: { 'Men': 'A', 'Women': 'B' },
            color: {
                'White': 'A', 'Black': 'B', 'Blue': 'C', 'Green': 'D',
                'Red': 'E', 'Yellow': 'F', 'Chocolate': 'G', 'Purple': 'H',
                'Orange': 'I', 'Sky-blue': 'J', 'Reddish': 'K', 'Pink': 'L'
            },
            size: { 'Small': 'A', 'Medium': 'B', 'Large': 'C' },
            age: { 'All': 'A', 'Young': 'B', 'Teens': 'C', 'Adult': 'D', 'Old': 'E' },
            status: { 'New': 'A', 'Used': 'B' },
            wealth: { 'Poor': 'A', 'Moderate': 'B', 'Rich': 'C' }
        };

        function generateSuggestionCode(product) {
            let code = '';
            code += metricMappings.category[product.category] || 'X'; code += '-';
            code += metricMappings.department[product.department] || 'X'; code += '-';
            const colors = Array.isArray(product.color) ? product.color : [product.color];
            code += colors.map(c => metricMappings.color[c] || 'X').join('+'); code += '-';
            code += metricMappings.size[product.size] || 'X'; code += '-';
            code += metricMappings.age[product.age] || 'X'; code += '-';
            code += metricMappings.status[product.status] || 'X'; code += '-';
            code += metricMappings.wealth[product.wealth] || 'X';
            return code;
        }

        function generatePersonalCode(userData) {
            if (!userData) return 'GUEST-CODE';
            let code = '';
            if (userData.gender) {
                code += metricMappings.department[userData.gender === 'Male' ? 'Men' : 'Women'] || 'X';
            } else { code += 'X'; } code += '-';
            if (userData.age) {
                let ageCategory = 'Adult';
                if (userData.age < 18) ageCategory = 'Teens';
                else if (userData.age < 25) ageCategory = 'Young';
                else if (userData.age > 60) ageCategory = 'Old';
                code += metricMappings.age[ageCategory] || 'X';
            } else { code += 'X'; } code += '-';
            const randomCategories = ['A', 'B', 'C', 'D'];
            code += randomCategories.join('+');
            return code;
        }

        function calculateMatchScore(userCode, productCode) {
            if (userCode === 'GUEST-CODE') return 0;
            const userParts = userCode.split('-');
            const productParts = productCode.split('-');
            let score = 0;
            for (let i = 0; i < Math.min(userParts.length, productParts.length); i++) {
                const userMetrics = userParts[i].split('+');
                const productMetrics = productParts[i].split('+');
                for (const userMetric of userMetrics) {
                    if (productMetrics.includes(userMetric)) { score += 1; break; }
                }
            }
            return score;
        }

        function sortProductsPersonalized(products, userCode) {
            if (userCode === 'GUEST-CODE') {
                return [...products].sort(() => Math.random() - 0.5);
            }
            const scoredProducts = products.map(product => {
                const matchScore = calculateMatchScore(userCode, product.suggestionCode);
                return { ...product, matchScore };
            });
            scoredProducts.sort((a, b) => b.matchScore - a.matchScore);
            return scoredProducts;
        }

        // ==================== PRODUCT LOADING ====================
        async function loadTopPicks() {
            try {
                const snapshot = await db.collection('products')
                    .where('active', '==', true)
                    .limit(20)
                    .get();
                
                const container = document.getElementById('topPicksGrid');
                container.innerHTML = '';
                
                const productsByCategory = {};
                snapshot.forEach(doc => {
                    const product = doc.data();
                    product.id = doc.id;
                    if (!productsByCategory[product.category]) {
                        productsByCategory[product.category] = [];
                    }
                    if (productsByCategory[product.category].length < 4) {
                        productsByCategory[product.category].push(product);
                    }
                });
                
                Object.keys(productsByCategory).forEach(category => {
                    const products = productsByCategory[category];
                    if (products.length === 0) return;
                    
                    const card = document.createElement('div');
                    card.className = 'top-pick-card';
                    card.innerHTML = `
                        <div class="card-header">
                            <div class="card-title">${category}</div>
                            <a href="#" class="view-all-link" data-category="${category}">View All</a>
                        </div>
                        <div class="product-images">
                            ${products.map(product => `
                                <div class="product-image" data-product="${product.id}">
                                    ${product.images && product.images[0] ? 
                                        `<img src="${product.images[0]}" alt="${product.name}">` : 
                                        `<i class='bx bx-image'></i>`
                                    }
                                </div>
                            `).join('')}
                        </div>
                    `;
                    
                    card.querySelectorAll('.product-image').forEach(img => {
                        img.addEventListener('click', function() {
                            const productId = this.getAttribute('data-product');
                            window.location.href = `view.html?id=${productId}`;
                        });
                    });
                    
                    card.querySelector('.view-all-link').addEventListener('click', function(e) {
                        e.preventDefault();
                        const category = this.getAttribute('data-category');
                        showFilteredProducts(category, 'category');
                    });
                    
                    container.appendChild(card);
                });
            } catch (error) {
                console.error('Error loading top picks:', error);
            }
        }

        async function loadPersonalizedDeals() {
            try {
                const snapshot = await db.collection('products').where('active', '==', true).get();
                allProducts = [];
                snapshot.forEach(doc => {
                    const product = doc.data();
                    product.id = doc.id;
                    product.suggestionCode = generateSuggestionCode(product);
                    allProducts.push(product);
                });
                
                const sortedProducts = sortProductsPersonalized(allProducts, userPersonalCode);
                displayDealsPage(sortedProducts);
            } catch (error) {
                console.error('Error loading personalized deals:', error);
            }
        }

        function displayDealsPage(products) {
            const container = document.getElementById('dealGrid');
            const startIndex = currentDealPage * dealsPerPage;
            const endIndex = startIndex + dealsPerPage;
            const pageProducts = products.slice(startIndex, endIndex);
            
            container.innerHTML = '';
            
            pageProducts.forEach((product, index) => {
                const dealCard = document.createElement('div');
                dealCard.className = 'deal-card';
                dealCard.innerHTML = `
                    ${product.discount ? `<div class="discount-badge">-${product.discount}%</div>` : ''}
                    <div class="relevance-indicator ${index < 3 ? 'show' : ''}"></div>
                    <div class="deal-image">
                        ${product.images && product.images[0] ? 
                            `<img src="${product.images[0]}" alt="${product.name}">` : 
                            `<div class="deal-img-placeholder"><i class='bx bx-image'></i></div>`
                        }
                        ${product.original ? `<div class="original-badge">Original</div>` : ''}
                    </div>
                    <div class="deal-title">${product.name}</div>
                    <div class="deal-price">${_0x3d8a7f(product.price)} RWF</div>
                    ${product.originalPrice ? `<div class="original-price">${_0x3d8a7f(product.originalPrice)} RWF</div>` : ''}
                `;
                
                dealCard.addEventListener('click', () => {
                    trackProductView(product.id);
                    window.location.href = `view.html?id=${product.id}`;
                });
                
                container.appendChild(dealCard);
            });
            
            const nextButton = document.getElementById('nextButton');
            const hasMoreProducts = (currentDealPage + 1) * dealsPerPage < products.length;
            nextButton.style.display = hasMoreProducts ? 'flex' : 'none';
        }

        async function trackProductView(productId) {
            if (!currentUser) return;
            try {
                await db.collection('user_activity').add({
                    userId: currentUser.uid,
                    productId: productId,
                    type: 'view',
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });
            } catch (error) {
                console.error('Error tracking product view:', error);
            }
        }

        // ==================== SITE PERSONALIZATION ====================
        async function loadSitePersonalization() {
            try {
                const doc = await db.collection('site_personalization').doc('settings').get();
                if (doc.exists) {
                    sitePersonalization = doc.data();
                    applySitePersonalization();
                    
                    db.collection('site_personalization').doc('settings')
                        .onSnapshot((snapshot) => {
                            sitePersonalization = snapshot.data();
                            applySitePersonalization();
                        });
                }
            } catch (error) {
                console.error('Error loading site personalization:', error);
            }
        }

        function applySitePersonalization() {
            if (!sitePersonalization) return;
            
            // Apply announcements
            const announcementBanner = document.getElementById('announcementBanner');
            const announcementContent = document.getElementById('announcementContent');
            
            if (sitePersonalization.announcements && sitePersonalization.announcements.length > 0) {
                const activeAnnouncement = sitePersonalization.announcements.find(a => a.active);
                if (activeAnnouncement) {
                    announcementContent.innerHTML = activeAnnouncement.content;
                    if (activeAnnouncement.link) {
                        announcementContent.innerHTML = `
                            <a href="${activeAnnouncement.link}" target="_blank">${activeAnnouncement.content}</a>
                        `;
                    }
                    announcementBanner.classList.add('show');
                } else {
                    announcementBanner.classList.remove('show');
                }
            } else {
                announcementBanner.classList.remove('show');
            }
            
            // Apply website status
            const pausedOverlay = document.getElementById('pausedOverlay');
            if (sitePersonalization.status === 'PAUSED') {
                pausedOverlay.classList.add('active');
                document.body.style.filter = 'grayscale(100%)';
                document.querySelectorAll('button, a, input').forEach(el => {
                    el.style.pointerEvents = 'none';
                    el.style.opacity = '0.6';
                });
            } else {
                pausedOverlay.classList.remove('active');
                document.body.style.filter = 'none';
                document.querySelectorAll('button, a, input').forEach(el => {
                    el.style.pointerEvents = 'auto';
                    el.style.opacity = '1';
                });
            }
            
            // Apply hero section customization
            if (sitePersonalization.heroImage) {
                document.getElementById('heroSection').style.backgroundImage = 
                    `linear-gradient(90deg, #000 0%, rgba(0,0,0,0.8) 30%, transparent 100%), url('${sitePersonalization.heroImage}')`;
            }
            
            if (sitePersonalization.heroTitle) {
                document.querySelector('.hero-title').textContent = sitePersonalization.heroTitle;
            }
        }

        // ==================== EVENT LISTENERS ====================
        function setupEventListeners() {
            // Next button for deals
            document.getElementById('nextButton').addEventListener('click', () => {
                currentDealPage++;
                loadPersonalizedDeals();
            });
            
            // Back to home button
            document.getElementById('backToHome').addEventListener('click', () => {
                document.getElementById('normalView').style.display = 'block';
                document.getElementById('filterView').classList.remove('active');
                document.getElementById('searchInput').value = '';
                document.getElementById('searchResults').classList.remove('active');
            });
            
            // Logo click
            document.querySelector('.logo-area').addEventListener('click', () => {
                window.location.href = 'index.html';
            });
        }

        // ==================== MAIN INITIALIZATION ====================
        async function initializeApp() {
            try {
                // Initialize all components
                initializeCart();
                initializeAuth();
                initializeSearch();
                initializeSubscription();
                
                // Load data
                await Promise.all([
                    loadSitePersonalization(),
                    loadCategories(),
                    loadTopPicks()
                ]);
                
                // Setup event listeners
                setupEventListeners();
                
                // Analytics
                if (analytics) {
                    analytics.logEvent('page_view', {
                        page_title: 'Homepage',
                        page_location: window.location.href
                    });
                }
                
                console.log('INGABO Store initialized successfully');
            } catch (error) {
                console.error('Initialization error:', error);
            }
        }
    </script>
</body>
</html>
